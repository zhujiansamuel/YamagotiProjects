https://www.1-chome.com/api/keitai/listPage
    ?accCode=
    &page=2
    &size=24
    &keyword=
    &isImpo=false
    &isCampaign=false
    &cateCode=sqwDCccRt4Woon0R
    &kbNames=
    &isImpoCate=false

https://www.1-chome.com/api/keitai/listPage
    ?accCode=
    &page=1
    &size=24
    &keyword=
    &isImpo=false
    &isCampaign=false
    &cateCode=RGNg976kptBN7UjF
    &kbNames=
    &isImpoCate=true


https://www.1-chome.com/api/index/getPopularCategories
{
    "code": 200,
    "msg": "success",
    "data": {
        "categoryIphone": "RGNg976kptBN7UjF",
        "categoryAndroid": "WkCcKCxwC6NInC5c",
        "categoryEarphone": "10000004",
        "categoryApple": "20030007",
        "categoryGame": "10000005",
        "categoryTablet": "20030016",
        "categoryCamera": "10000001",
        "categoryWhiskey": "30010001"
    }
}

https://www.1-chome.com/api/keitai/getAllCateTreeList?cateCode=R0000001

AppleStockChecker



http://127.0.0.1:8080/AppleStockChecker/auth/token/
http://127.0.0.1:8080/AppleStockChecker/import-iphone-csv/
http://127.0.0.1:8080/AppleStockChecker/delivery-trend/
http://127.0.0.1:8080/AppleStockChecker/dashboard/
http://127.0.0.1:8080/AppleStockChecker/store-latest/
http://127.0.0.1:8080/AppleStockChecker/resale-trend-pn-merged/
http://127.0.0.1:8080/AppleStockChecker/external-ingest/

/admin/easyaudit/crudevent/
/admin/easyaudit/loginevent/
/admin/easyaudit/requestevent/

docker run -d --name redis  -p 6379:6379  -e REDIS_ARGS="--appendonly yes --save 900 1 --save 300 10"  redis:7-alpine
celery -A YamagotiProjects worker -l info
celery -A YamagotiProjects worker -l info -P solo --concurrency=1


http://localhost:8080/AppleStockChecker/auth/token/



git clone https://github.com/zhujiansamuel/YamagotiProjects.git src
scp ./db.sqlite3 root@47.111.136.177:/opt/apple/db/db.sqlite3




显示效果好极了。现在我有一系列新的改进需求，我将一一告知你，请给出最终可用的完整代码，在相应地方添加详细注释说明为满足需求而修改的地方。
需求1，现在的图标之上增加一个新的图表，它的绘制方法是将同一二手店的同一型号的不同颜色的价格取平均值之后作图，同样给出平均值。
需求2-1，平均值曲线可以选择分割桶的间隔（30分钟，1小时，10小时，24小时），当然也保留可以选择那些店铺进行计算的原有功能。
需求2-2，可以更改平均值曲线的粗细，可以更改颜色，可以修改线的类型(实线，虚线，点线等)。
需求2-3，这样的平均值曲线需要3条，代码中允许我修改他们默认的属性（分割桶的间隔，粗细，颜色，计算包含的二手店铺）
需求3，纵坐标放在图的右边。
需求4，在曲线的最右边增加一个标注，显示距离纵坐标轴最近的点（曲线的最右点）的数值（各个二手店价格以及各个平均价格）
需求5，横坐标只标注日期，位置在每天的0点。


说明 & 可调参数汇总

平均线 3 条默认值在 AVG_LINES_DEFAULTS 中集中定义：

const AVG_LINES_DEFAULTS = [
  { id:'A', label:'平均线 A', bucketMinutes:30,  lineWidth:3, color:'#000000', dash:'solid', shops:'ALL' },
  { id:'B', label:'平均线 B', bucketMinutes:60,  lineWidth:2, color:'#ff0077', dash:'dash',  shops:'ALL' },
  { id:'C', label:'平均线 C', bucketMinutes:1440,lineWidth:2, color:'#00bcd4', dash:'dot',   shops:'ALL' },
];





SHOP_DISPLAY_ORDER = [
  {match:/買取商店/,color:"#DD1133",shop_id:14,order:1},
  {match:/海峡通信/,color:"#478CD8",shop_id:1,order:2},
  {match:/買取一丁目/,color:"#B41524",shop_id:8,order:3},
  {match:/モバイルミックス/,color:"#DD1133",shop_id:13,order:4},
  {match:/森森買取/,color:"#278C46",shop_id:7,order:5},
  {match:/買取ルデヤ/,color:"#2DA9E8",shop_id:9,order:6},
  {match:/買取wiki/,color:"#E71534",shop_id:10,order:7},
  {match:/買取ホムラ/,color:"#F27474",shop_id:19,order:8},
  {match:/ドラゴンモバイル/,color:"#3952A6",shop_id:16,order:9},
  {match:/モバステ/,color:"#E60012",shop_id:18,order:10},
  {match:/アキモバ/,color:"#20AECC",shop_id:12,order:11},
  {match:/トゥインクル/,color:"#0EC7D9",shop_id:17,order:12},
  {match:/家電市場/,color:"#FFF100",shop_id:3,order:13},
  {match:/買取楽園/,color:"#DA7C66",shop_id:4,order:14},
  {match:/買取当番/,color:"#1C4473",shop_id:2,order:15},
  {match:/携帯空間/,color:"#0049A8",shop_id:5,order:16},
  {match:/ゲストモバイル/,color:"#34C6F6",shop_id:11,order:17},
  {match:/買取オク/,color:"#033F68",shop_id:6,order:18},
  {match:/毎日買取/,color:"#C30D23",shop_id:15,order:19},
  {match:/Mobile Zone/,color:"#f50620",shop_id:20,order:20},
];



{id: "iphone-17-pro-max-256", model: "iPhone 17 Pro Max", cap: 256,iphone_id:[20,21,22]},
{id: "iphone-17-pro-max-512", model: "iPhone 17 Pro Max", cap: 512,iphone_id:[23,24,25]},
{id: "iphone-17-pro-max-1024", model: "iPhone 17 Pro Max", cap: 1024,iphone_id:},
{id: "iphone-17-pro-max-2048", model: "iPhone 17 Pro Max", cap: 2048,iphone_id:},
{id: "iphone-17-pro-256", model: "iPhone 17 Pro", cap: 256,iphone_id:[11,12,13]},
{id: "iphone-17-pro-512", model: "iPhone 17 Pro", cap: 512,iphone_id:[14,15,16]},
{id: "iphone-17-pro-1024", model: "iPhone 17 Pro", cap: 1024,iphone_id:[17,18,19]},
{id: "iphone-Air-256", model: "iPhone Air", cap: 256,iphone_id:[32,33,34,35]},
{id: "iphone-Air-512", model: "iPhone Air", cap: 512,iphone_id:[36,37,38,39]},
{id: "iphone-Air-1024", model: "iPhone Air", cap: 1024,iphone_id:[40,41,42,43]},
{id: "iphone-17-256", model: "iPhone 17", cap: 256,iphone_id:[1,2,3,4,5]},
{id: "iphone-17-512", model: "iPhone 17", cap: 512,iphone_id:[6,7,8,9,10]},


git fetch --all --prune
git reset --hard origin/master
git pull origin master
docker compose build
docker compose up -d web nginx

docker compose up -d --scale worker=5

docker compose logs -f web
docker compose logs -f celery
docker compose logs -f nginx

docker compose up -d --scale worker=6


docker ps -a
docker logs -f apple-web-1 --tail 200

docker logs -f apple-nginx-1 --tail 200

https://api.webscraper.io/api/v1/scraping-jobs?sitemap_id=1367906&api_token=



localStorage.setItem('iphone:token', ' ;

localStorage.setItem('iphone:token', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzYwOTUyNDYzLCJpYXQiOjE3NjA5NTA2NjQsImp0aSI6ImMwYjJiMmI3YTM1OTRiNDJhYWM2YWFhYmVjMjhhNTkxIiwidXNlcl9pZCI6IjEifQ.MFVyUl1IYMOVILX2nAYyKPWs4R3Sr9FYaoIznAOC2GA');



brew services start redis
python manage.py runserver 127.0.0.1:8000
celery -A YamagotiProjects worker -l info
celery -A YamagotiProjects beat -l info

celery -A YamagotiProjects flower --port=5555


celery -A YamagotiProjects beat -l info --scheduler 

django_celery_beat.schedulers:DatabaseScheduler


celery -A YamagotiProjects worker -l info -P threads --concurrency=8

celery -A YamagotiProjects worker -l info -P eventlet --concurrency=15
daphne -b 0.0.0.0 -p 8000 YamagotiProjects.asgi:application

--------------------------------------------
ACCESS="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzYwOTU0Njk5LCJpYXQiOjE3NjA5NTI4OTksImp0aSI6IjgyOThjMDE3Zjk0NDQyMGU4YzliZWQ4ZjVhNzY0M2Y2IiwidXNlcl9pZCI6IjEifQ.R_V82ZJAx_d7YuNKoWP3K8XQZ7apLx81GiTNIdu0XYs"
noglob websocat -t \
  -H='Origin: https://yamaguti.ngrok.io' \
  -H="Authorization: Bearer $ACCESS" \
  "wss://yamaguti.ngrok.io/ws/stream/psta/?token=$ACCESS"
--------------------------------------------
ACCESS="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzYwOTI1OTM0LCJpYXQiOjE3NjA5MjQxMzQsImp0aSI6ImRiMjBiYjdiZTYxMzRlNjA4ZTgyYTk1NjQ2MmY4NGI4IiwidXNlcl9pZCI6IjEifQ.pNPnkVH1nnMfxJlcEPrOufFGkuPJzNN9lpJ2Ys9w0fM"

noglob websocat -t \
  -H='Origin: https://127.0.0.1' \
  -H="Authorization: Bearer $ACCESS" \
  "wss://127.0.0.1/ws/stream/psta/?token=$ACCESS"




shop1---->ok
shop2---->ok
shop3---->ok
shop4---->ok
shop5---->ok
shop6---->ok
shop7---->取得数据有问题，颜色待修改
shop8---->ok
shop9---->ok
shop10--->ok
shop11--->403，原因未明
shop12--->ok
shop13--->ok
shop14--->ok
shop15--->减价信息在价格栏
shop16--->ok
shop18--->ok
shop20--->ok

https://verbless-sadistically-jayceon.ngrok-free.dev/AppleStockChecker/purchasing-time-analyses-psta-compact/?start=2025-10-11T00:00:00%2B09:00&end=2025-10-13T00:00:00%2B09:00


docker compose build
docker compose run --rm -v "$PWD":/app web python manage.py makemigrations AppleStockChecker
docker compose run --rm -v "$PWD":/app web python manage.py makemigrations AppleStockChecker

docker compose run --rm -v "$PWD":/app -w /app web bash -lc '
  unset DB_HOST DB_PORT DB_NAME DB_USER DB_PASSWORD && \
  python manage.py dumpdata \
    --natural-foreign --natural-primary \
    -e contenttypes -e admin.logentry -e sessions -e auth.permission \
    --indent 2 > /app/sqlite_data.json
'

docker compose run --rm web bash -lc '
  unset DB_HOST DB_PORT DB_NAME DB_USER DB_PASSWORD;
  python manage.py dumpdata \
    --natural-foreign --natural-primary \
    -e contenttypes -e admin.logentry -e sessions -e auth.permission \
    --indent 2 > /app/sqlite_data.json
'

docker compose run --rm web bash -lc '
  python manage.py dumpdata \
    --database=sqlite_old \
    --natural-foreign --natural-primary \
    -e contenttypes -e admin.logentry -e sessions -e auth.permission \
    --indent 2 > sqlite_data.json'




docker compose run --rm web bash -lc '
  python manage.py loaddata /app/sqlite_data.json
'



CREATE USER samuelzhujian WITH PASSWORD 'Xdb73008762' LOGIN;
CREATE DATABASE yappdb OWNER samuelzhujian ENCODING 'UTF8';
GRANT ALL PRIVILEGES ON DATABASE yappdb TO samuelzhujian;
\q

export SQLITE_PATH="/Users/syu/PycharmProjects/YamagotiProjects/db.sqlite3"
export PG_URL="postgresql://samuelzhujian:Xdb73008762@localhost:5432/yappdb"


docker compose exec -T db bash -lc 'psql -U "$POSTGRES_USER" -d yappdb -c "\dt"'

export DATABASE_URL="postgresql://samuelzhujian:Xdb73008762@127.0.0.1:5432/yappdb"

docker compose exec -T db bash psql "postgresql://samuelzhu:Xdb73008762@127.0.0.1:5432/yappdb" -c "\dt"

docker compose exec -T db bash -lc 'psql "postgresql://samuelzhu:Xdb73008762@127.0.0.1:5432/yappdb" -c "\dt" '


psql "postgresql://samuelzhujian:Xdb73008762@127.0.0.1:5432/yappdb" -c "\dt"

psql "postgresql://samuelzhujian:Xdb73008762@127.0.0.1:5432/yappdb"


celery -A YamagotiProjects worker -l info -P threads --concurrency=8


brew services start postgresql@16


ALTER TABLE applestockchecker_inventoryrecord RENAME TO "Applestockchecker_inventoryrecord";
ALTER TABLE applestockchecker_iphone RENAME TO "Applestockchecker_iphone";
ALTER TABLE applestockchecker_officialstore RENAME TO "Applestockchecker_officialstore";
ALTER TABLE applestockchecker_purchasingshoppricerecord RENAME TO "Applestockchecker_purchasingshoppricerecord";
ALTER TABLE applestockchecker_purchasingshoptimeanalysis RENAME TO "Applestockchecker_purchasingshoptimeanalysis";
ALTER TABLE applestockchecker_secondhandshop RENAME TO "Applestockchecker_secondhandshop";








celery -A YamagotiProjects beat -l info --scheduler django_celery_beat.schedulers:DatabaseScheduler




pkill -f 'celery worker' ; celery -A YamagotiProjects worker -l info --concurrency=15




http POST :8000/AppleStockChecker/dispatch-psta-batch-same-ts \
  items:='[
    {"shop_id":1,"iphone_id":2,"Original_Record_Time_Zone":"+09:00","Timestamp_Time_Zone":"+09:00",
     "Record_Time":"2025-10-10T17:30:00+09:00","Alignment_Time_Difference":0,"New_Product_Price":211000}
  ]'

curl -X POST http://127.0.0.1:8000/AppleStockChecker/purchasing-time-analyses/dispatch_ts/\
  -H 'Content-Type: application/json' \
  -d '{"timestamp_iso":"2025-10-10T17:30:00+09:00"}'


curl -X POST http://127.0.0.1:8000/AppleStockChecker/dispatch-psta-batch-same-ts \
     -H "Content-Type: application/json" \
     -d '{
       "items":[
         {"shop_id":1,"iphone_id":2,"Original_Record_Time_Zone":"+09:00","Timestamp_Time_Zone":"+09:00",
          "Record_Time":"2025-10-10T17:30:00+09:00","Alignment_Time_Difference":0,"New_Product_Price":211000},
         {"shop_id":2,"iphone_id":3,"Original_Record_Time_Zone":"+09:00","Timestamp_Time_Zone":"+09:00",
          "Record_Time":"2025-10-10T17:30:00+09:00","Alignment_Time_Difference":0,"New_Product_Price":198000}
       ]
     }'



curl -X POST "http://127.0.0.1:8000/AppleStockChecker/purchasing-time-analyses/dispatch_ts/" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzYwMDg5OTY0LCJpYXQiOjE3NjAwODgxNjQsImp0aSI6IjhiMWM1YmNjODJkMzQ1ZTY4MjI0YzBkOTliMjQ1M2ZkIiwidXNlcl9pZCI6IjEifQ.0wuipdD3kugCuI1Lbqyk6I_Y9lYT1dog6UctXIGu3f0" \
  -d '{
    "items": [
      {"shop_id":1,"iphone_id":2,"Original_Record_Time_Zone":"+09:00","Timestamp_Time_Zone":"+09:00",
       "Record_Time":"2025-10-10T18:30:00+09:00","Alignment_Time_Difference":0,"New_Product_Price":211000}
    ]
  }'


curl -X POST "http://127.0.0.1:8000/AppleStockChecker/purchasing-time-analyses/dispatch_ts/"


curl -X POST http://127.0.0.1:8000/AppleStockChecker/purchasing-time-analyses/dispatch_ts/\
  -H 'Content-Type: application/json' \
  -d '{"timestamp_iso":"2025-10-10T17:30:00+09:00"}'




curl -i -X POST \
  "http://127.0.0.1:8000/AppleStockChecker/purchasing-price-records/import-tradein-xlsx/?dry_run=0" \
  -H "Authorization: Bearer ${ACCESS}" \
  -F "files=@/Users/syu/Downloads/shop2.xlsx"


curl -i -X POST \
  "http://yamaguti.ngrok.io/AppleStockChecker/purchasing-price-records/import-tradein-xlsx/?dry_run=0" \
  -H "Authorization: Bearer ${ACCESS}" \
  -F "files=@/Users/syu/Downloads/shop2.xlsx"






curl -i "https://verbless-sadistically-jayceon.ngrok-free.dev/AppleStockChecker/purchasing-time-analyses-psta-compact/?start=2025-10-11T00:00:00%2B09:00&end=2025-10-13T00:00:00%2B09:00"\
  -H "Accept: application/json" \
  -H "ngrok-skip-browser-warning: 1"






https://verbless-sadistically-jayceon.ngrok-free.dev/AppleStockChecker/purchasing-time-analyses-psta-compact/?start=2025-10-10T09:00:00%2B09:00&end=2025-10-11T20:00:00%2B09:00&shop=11&iphone__jan=4549995648300



docker compose run --rm \
  -e DJANGO_SUPERUSER_USERNAME=samuelzhu \
  -e DJANGO_SUPERUSER_EMAIL=samuel201111@gmail.com \
  -e DJANGO_SUPERUSER_PASSWORD='Xdb73008762' \
  web python manage.py createsuperuser --noinput



curl -v --max-time 600 \
  -H "Authorization: Bearer ${ACCESS}" \
  -F "files=@/Users/syu/PycharmProjects/YamagotiProjects/WebScraperData/shop18/shop18.xlsx" \
  "https://yamaguti.ngrok.io/AppleStockChecker/purchasing-price-records/import-tradein-xlsx/?dry_run=0"



curl -I http://yamaguti.ngrok.io/AppleStockChecker/static/admin/simplepro/images/bg.svg

curl -i https://yamaguti.ngrok.io/AppleStockChecker/static/admin/simplepro/images/bg.svg



recorded_after
recorded_before

https://yamaguti.ngrok.io/AppleStockChecker/purchasing-price-records/?recorded_after= & recorded_before=

https://yamaguti.ngrok.io/AppleStockChecker/purchasing-time-analyses/psta-compact/?start=2025-10-01T10%3A00%3A00%2B09%3A00&end=2025-10-20T10%3A00%3A00%2B09%3A00&shop=13&iphone__part_number=MG854J%2FA

<!-- ================= iPhone 17 Pro Max ================= -->

....

<tr data-color="blue">....
<tr data-color="silver">....
<!-- 512GB -->
<tr>...
<tr class="avg-row" data-color="all">....
<tr data-color="orange">....
<tr data-color="blue">....
<tr data-color="silver">....
<!-- 1TB -->
<tr>...
<tr class="avg-row" data-color="all">....
<tr data-color="orange">....
<tr data-color="blue">....
<tr data-color="silver">....
<!-- 2TB -->
<tr>...
<tr class="avg-row" data-color="all">....
<tr data-color="orange">....
<tr data-color="blue">....
<tr data-color="silver">....

....
<!-- ================= iPhone 17 Pro ================= -->
....
<tr data-color="blue">....
<tr data-color="silver">....
<!-- 512GB -->
<tr>...
<tr class="avg-row" data-color="all">....
<tr data-color="orange">....
<tr data-color="blue">....
<tr data-color="silver">....
<!-- 1TB -->
<tr>...
<tr class="avg-row" data-color="all">....
<tr data-color="orange">....
<tr data-color="blue">....
<tr data-color="silver">....


curl -X POST https://verbless-sadistically-jayceon.ngrok-free.dev/AppleStockChecker/post-to-x/ \
     -H "Content-Type: application/json" \
     -d '{"base64Image": "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI5gAAAABJRU5ErkJggg==", "caption": "Test post"}'




スマホ、ゲーム機等の買取価格を監視しています。毎日10:30〜18:30頃に配信します。対象店舗は固定ポストをご参照ください。 #iPhone17買取相場 / #iPhone16買取相場 / #iPhone15買取相場 / #Android買取相場 / #Pixel買取相場 / #Game買取相場

#iPhone17買取相場
#iPhone17買取相場20251024
最終更新日時：2025/10/24（金）12時00分

curl "https://docs.google.com/spreadsheets/d/e/2PACX-1vTHgVMpH0FnvdAmk2sqEUVkexuuo5oA5XNZTaTbCMGMpy8HSK3TImgQviU99UX-STS4B4IuNrnYG7Sz/pubhtml?gid=1011791912&single=true&range=A1:B152&widget=false&headers=false&chrome=false"


https://docs.google.com/spreadsheets/d/e/2PACX-1vTHgVMpH0FnvdAmk2sqEUVkexuuo5oA5XNZTaTbCMGMpy8HSK3TImgQviU99UX-STS4B4IuNrnYG7Sz/pubhtml?gid=1011791912&single=true&range=A1:B152&widget=false&headers=false&chrome=false

